import{r as d,s as p,j as e}from"./index-CAX25aQK.js";const l={MYDAY:"myday",CREATE:"create",UPDATE:"update",LINKED:"linked"};function Ce(){var ce,me;const[o,T]=d.useState(null),[$,P]=d.useState([]),[D,L]=d.useState([]),[M,O]=d.useState([]),[U,C]=d.useState(!0),[x,g]=d.useState(!1),[pe,S]=d.useState(!1),[b,j]=d.useState(null),[he,X]=d.useState(!1),[Z,H]=d.useState(!1),[u,h]=d.useState(l.MYDAY),[a,N]=d.useState(null),[R,ee]=d.useState("create"),[r,te]=d.useState({subject:"",sender:"",body:"",start:null,end:null,isAppointment:!1,messageId:"",itemId:""}),[c,f]=d.useState({title:"",description:"",project_id:"",status:"todo",critical:!1,due_date:""}),[_,se]=d.useState(""),[y,A]=d.useState(null),[Y,V]=d.useState(""),[B,re]=d.useState(null);d.useEffect(()=>{const s=new URLSearchParams(window.location.search).get("mode");s==="myday"?h(l.MYDAY):s==="create"?h(l.CREATE):s==="update"&&h(l.UPDATE)},[]),d.useEffect(()=>{(()=>{if(typeof Office<"u"){H(!0);return}const s=document.createElement("script");s.src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js",s.onload=()=>H(!0),s.onerror=()=>H(!0),document.head.appendChild(s)})()},[]),d.useEffect(()=>{if(!Z)return;(()=>{typeof Office<"u"&&Office.onReady?Office.onReady(s=>{if(X(!0),s.host===Office.HostType.Outlook){const n=Office.context.mailbox.item;n&&fe(n)}}):X(!0)})()},[Z]);const fe=t=>{var m,v,E,q,xe;const n=t.itemType===((v=(m=Office.MailboxEnums)==null?void 0:m.ItemType)==null?void 0:v.Appointment),i=t.itemId||"";if(n){const I=t.subject||"",k=t.start,J=t.end;te({subject:I,sender:"",body:"",start:k,end:J,isAppointment:!0,messageId:"",itemId:i}),f(Q=>({...Q,title:I,due_date:k?new Date(k).toISOString().split("T")[0]:""}))}else{const I=t.subject||"",k=((E=t.from)==null?void 0:E.displayName)||((q=t.from)==null?void 0:q.emailAddress)||"",J=((xe=t.from)==null?void 0:xe.emailAddress)||"",Q=t.internetMessageId||"";t.body.getAsync(Office.CoercionType.Text,ue=>{if(ue.status===Office.AsyncResultStatus.Succeeded){const De=ue.value||"";te({subject:I,sender:k,body:De,start:null,end:null,isAppointment:!1,messageId:Q,itemId:i}),f(Le=>({...Le,title:I,description:`From: ${k} <${J}>`}))}})}};d.useEffect(()=>{o&&r.itemId&&r.isAppointment&&je(r.itemId)},[o,r.itemId,r.isAppointment]);const je=async t=>{if(t)try{const{data:s,error:n}=await p.from("tasks").select("*, projects(name)").eq("calendar_event_id",t).single();s&&!n?(N(s),h(l.LINKED)):N(null)}catch{N(null)}};d.useEffect(()=>{(async()=>{C(!0);try{const{data:{session:s}}=await p.auth.getSession();s!=null&&s.user&&(T(s.user),await ae())}catch(s){console.error("Init error:",s)}C(!1)})()},[]),d.useEffect(()=>{o&&u===l.MYDAY?w():o&&(u===l.UPDATE||u===l.CREATE)&&z()},[u,o]);const ae=async()=>{const{data:t}=await p.from("projects").select("*").order("created_at",{ascending:!1});t&&t.length>0&&(P(t),f(s=>({...s,project_id:t[0].id}))),await w(),await z()},w=async()=>{try{const t=new Date().toISOString().split("T")[0],{data:s,error:n}=await p.from("tasks").select("*, projects(name)").or(`my_day_date.eq.${t},due_date.eq.${t}`).neq("status","done").order("critical",{ascending:!1}).order("due_date",{ascending:!0});!n&&s&&L(s)}catch(t){console.error("loadMyDayTasks error:",t)}},z=async()=>{try{const{data:t,error:s}=await p.from("tasks").select("*, projects(name)").neq("status","done").order("updated_at",{ascending:!1}).limit(100);!s&&t&&O(t)}catch(t){console.error("loadAllTasks error:",t)}},be=async t=>{t.preventDefault(),j(null),g(!0);const s=new FormData(t.target),n=s.get("email"),i=s.get("password"),{data:m,error:v}=await p.auth.signInWithPassword({email:n,password:i});if(v){j(v.message),g(!1);return}T(m.user),await ae(),g(!1)},ne=async t=>{var s,n;t.preventDefault(),g(!0),j(null);try{let i="";if(r.isAppointment)i=`Meeting: ${r.subject}
Date: ${r.start?new Date(r.start).toLocaleString():"N/A"}`;else{const q=((s=r.body)==null?void 0:s.substring(0,500))||"";i=`Email from: ${r.sender}
Subject: ${r.subject}

${q}${((n=r.body)==null?void 0:n.length)>500?"...":""}`}const m={title:c.title,description:c.description,project_id:c.project_id,status:c.status,critical:c.critical,due_date:c.due_date||null,source:r.isAppointment?"meeting":"email",source_link:r.messageId||null,notes:i,energy_level:"medium"};r.isAppointment&&r.itemId&&(m.calendar_event_id=r.itemId,r.start&&(m.start_time=new Date(r.start).toTimeString().slice(0,5)),r.end&&(m.end_time=new Date(r.end).toTimeString().slice(0,5)));const{data:v,error:E}=await p.from("tasks").insert(m).select("*, projects(name)").single();if(E)throw E;r.isAppointment&&v&&N(v),S(!0),await w()}catch(i){j(i.message)}finally{g(!1)}},ye=async t=>{if(!(!r.itemId||!r.isAppointment)){g(!0),j(null);try{const s={calendar_event_id:r.itemId,updated_at:new Date().toISOString()};r.start&&(s.start_time=new Date(r.start).toTimeString().slice(0,5),s.due_date=new Date(r.start).toISOString().split("T")[0]),r.end&&(s.end_time=new Date(r.end).toTimeString().slice(0,5));const{data:n,error:i}=await p.from("tasks").update(s).eq("id",t.id).select("*, projects(name)").single();if(i)throw i;N(n),h(l.LINKED),A(null)}catch(s){j(s.message)}finally{g(!1)}}},ve=async()=>{if(a){g(!0);try{const{error:t}=await p.from("tasks").update({status:"done",updated_at:new Date().toISOString()}).eq("id",a.id);if(t)throw t;N({...a,status:"done"}),S(!0)}catch(t){j(t.message)}finally{g(!1)}}},Ne=async()=>{if(a){g(!0);try{const{error:t}=await p.from("tasks").update({calendar_event_id:null,updated_at:new Date().toISOString()}).eq("id",a.id);if(t)throw t;N(null),h(l.CREATE)}catch(t){j(t.message)}finally{g(!1)}}},we=async()=>{if(y){g(!0),j(null);try{let s=`

--- ${new Date().toLocaleString()} ---
`;r.isAppointment?s+=`ðŸ“… Meeting: ${r.subject}
`:s+=`ðŸ“§ Email from: ${r.sender}
Subject: ${r.subject}
`,Y.trim()&&(s+=`
${Y.trim()}`);const n=(y.notes||"")+s,{error:i}=await p.from("tasks").update({notes:n,updated_at:new Date().toISOString()}).eq("id",y.id);if(i)throw i;S(!0),A(null),V(""),await w(),await z()}catch(t){j(t.message)}finally{g(!1)}}},ie=async t=>{const s=t.status==="done"?"todo":"done",{error:n}=await p.from("tasks").update({status:s}).eq("id",t.id);n||L(s==="done"?i=>i.filter(m=>m.id!==t.id):i=>i.map(m=>m.id===t.id?{...m,status:s}:m))},oe=async t=>{const s=new Date().toISOString().split("T")[0],i=t.my_day_date===s?null:s,{error:m}=await p.from("tasks").update({my_day_date:i}).eq("id",t.id);m||await w()},ke=()=>{S(!1),A(null),V(""),f(t=>({...t,title:r.subject||"",description:r.sender?`From: ${r.sender}`:"",critical:!1,due_date:""}))},de=t=>{if(!t)return"";const s=new Date(t),n=new Date,i=new Date(n);return i.setDate(i.getDate()+1),t===n.toISOString().split("T")[0]?"Today":t===i.toISOString().split("T")[0]?"Tomorrow":s.toLocaleDateString("en-GB",{day:"numeric",month:"short"})},le=t=>t?t.slice(0,5):"",Te=()=>new Date().toLocaleDateString("en-GB",{weekday:"long",day:"numeric",month:"long"}),W=_.trim()?M.filter(t=>{var s,n;return t.title.toLowerCase().includes(_.toLowerCase())||((n=(s=t.projects)==null?void 0:s.name)==null?void 0:n.toLowerCase().includes(_.toLowerCase()))}):M.slice(0,10);if(U||!he)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Loading..."})]})});if(!o)return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-indigo-50 p-4",children:[e.jsxs("div",{className:"text-center mb-6 pt-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 flex items-center justify-center mx-auto mb-3",children:e.jsx("svg",{className:"w-7 h-7 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})})}),e.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Trackli"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Track. Manage. Deliver."})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[b&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-xl text-sm text-red-700",children:b}),e.jsxs("form",{onSubmit:be,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),e.jsx("input",{type:"email",name:"email",required:!0,className:"w-full px-4 py-2.5 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm",placeholder:"you@example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),e.jsx("input",{type:"password",name:"password",required:!0,className:"w-full px-4 py-2.5 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"})]}),e.jsx("button",{type:"submit",disabled:x,className:"w-full py-2.5 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-xl hover:from-indigo-600 hover:to-purple-600 transition-all font-medium text-sm disabled:opacity-50",children:x?"Signing in...":"Sign In"})]})]})]});if(pe)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-indigo-50 p-4 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-green-100 flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:(a==null?void 0:a.status)==="done"?"Task Completed!":u===l.UPDATE?"Task Updated!":"Task Created!"}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:(a==null?void 0:a.status)==="done"?"Marked as done in Trackli":u===l.UPDATE?"Note added successfully":"Added to Trackli"}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx("button",{onClick:()=>{h(l.MYDAY),S(!1)},className:"px-4 py-2.5 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-all font-medium text-sm",children:"View My Day"}),e.jsx("button",{onClick:ke,className:"px-4 py-2.5 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-xl hover:from-indigo-600 hover:to-purple-600 transition-all font-medium text-sm",children:"Continue"})]})]})});const F=new Date().toISOString().split("T")[0],K=D.filter(t=>t.my_day_date===F),G=D.filter(t=>t.due_date===F&&t.my_day_date!==F);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-indigo-50 flex flex-col",children:[e.jsxs("div",{className:"bg-white border-b border-gray-200 px-3 pt-3 pb-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-7 h-7 rounded-lg bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})})}),e.jsx("span",{className:"font-bold text-gray-800 text-sm",children:"Trackli"})]}),e.jsxs("div",{className:"flex flex-wrap",children:[e.jsxs("button",{onClick:()=>h(l.MYDAY),className:`flex items-center gap-1 px-3 py-2 text-xs font-medium rounded-t-lg transition-colors ${u===l.MYDAY?"bg-gradient-to-br from-slate-50 to-indigo-50 text-indigo-600 border-t border-l border-r border-gray-200":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}),"My Day"]}),(a||r.isAppointment)&&e.jsxs("button",{onClick:()=>h(l.LINKED),className:`flex items-center gap-1 px-3 py-2 text-xs font-medium rounded-t-lg transition-colors ${u===l.LINKED?"bg-gradient-to-br from-slate-50 to-indigo-50 text-indigo-600 border-t border-l border-r border-gray-200":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),a?"Linked":"Link",a&&e.jsx("span",{className:"ml-1 w-2 h-2 rounded-full bg-green-500"})]}),e.jsxs("button",{onClick:()=>h(l.CREATE),className:`flex items-center gap-1 px-3 py-2 text-xs font-medium rounded-t-lg transition-colors ${u===l.CREATE?"bg-gradient-to-br from-slate-50 to-indigo-50 text-indigo-600 border-t border-l border-r border-gray-200":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Create"]}),e.jsxs("button",{onClick:()=>h(l.UPDATE),className:`flex items-center gap-1 px-3 py-2 text-xs font-medium rounded-t-lg transition-colors ${u===l.UPDATE?"bg-gradient-to-br from-slate-50 to-indigo-50 text-indigo-600 border-t border-l border-r border-gray-200":"text-gray-500 hover:text-gray-700"}`,children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Update"]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[u===l.LINKED&&e.jsxs("div",{className:"p-4",children:[r.subject&&r.isAppointment&&e.jsxs("div",{className:"mb-4 p-3 bg-white rounded-xl border border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 mb-1",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{children:"Meeting"}),r.start&&e.jsxs("span",{className:"text-gray-400",children:["â€¢ ",new Date(r.start).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),r.end&&` - ${new Date(r.end).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})}`]})]}),e.jsx("p",{className:"text-sm font-medium text-gray-800",children:r.subject})]}),b&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-xl text-sm text-red-700",children:b}),a?e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("svg",{className:"w-4 h-4 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),e.jsx("span",{className:"text-sm font-medium text-green-700",children:"Linked Task"})]}),e.jsx("div",{className:`p-4 rounded-xl border-2 ${a.status==="done"?"bg-gray-50 border-gray-200":"bg-indigo-50 border-indigo-200"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center flex-shrink-0 ${a.status==="done"?"bg-green-500 border-green-500":"border-gray-300"}`,children:a.status==="done"&&e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:`font-medium ${a.status==="done"?"line-through text-gray-400":"text-gray-800"}`,children:[a.critical&&e.jsx("span",{className:"text-red-500 mr-1",children:"ðŸš©"}),a.title]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[((ce=a.projects)==null?void 0:ce.name)&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-indigo-100 text-indigo-600",children:a.projects.name}),e.jsx("span",{className:"text-xs text-gray-400",children:a.status.replace("_"," ")}),a.start_time&&e.jsxs("span",{className:"text-xs text-gray-400",children:[le(a.start_time),a.end_time&&` - ${le(a.end_time)}`]})]})]})]})}),a.status!=="done"?e.jsxs("button",{onClick:ve,disabled:x,className:"mt-4 w-full py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-xl hover:from-green-600 hover:to-emerald-600 transition-all font-medium text-sm disabled:opacity-50 flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),x?"Marking...":"Mark as Done"]}):e.jsx("div",{className:"mt-4 p-3 bg-green-50 rounded-xl text-center",children:e.jsx("p",{className:"text-sm text-green-700 font-medium",children:"âœ“ Task completed"})}),e.jsx("button",{onClick:Ne,disabled:x,className:"mt-2 w-full py-2 text-xs text-gray-500 hover:text-red-500 transition-colors",children:"Unlink from this meeting"})]}):e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"No task linked to this meeting yet."}),e.jsxs("div",{className:"flex rounded-lg bg-gray-100 p-1 mb-4",children:[e.jsx("button",{onClick:()=>ee("create"),className:`flex-1 py-2 text-xs font-medium rounded-md transition-colors ${R==="create"?"bg-white text-indigo-600 shadow-sm":"text-gray-500"}`,children:"Create New"}),e.jsx("button",{onClick:()=>ee("existing"),className:`flex-1 py-2 text-xs font-medium rounded-md transition-colors ${R==="existing"?"bg-white text-indigo-600 shadow-sm":"text-gray-500"}`,children:"Link Existing"})]}),R==="create"?e.jsxs("form",{onSubmit:ne,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Task Title"}),e.jsx("input",{type:"text",required:!0,value:c.title,onChange:t=>f(s=>({...s,title:t.target.value})),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Project"}),e.jsx("select",{value:c.project_id,onChange:t=>f(s=>({...s,project_id:t.target.value})),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm",children:$.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]}),e.jsx("button",{type:"submit",disabled:x||!c.title||!c.project_id,className:"w-full py-2.5 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-xl hover:from-indigo-600 hover:to-purple-600 transition-all font-medium text-sm disabled:opacity-50",children:x?"Creating...":"Create & Link Task"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"text",value:_,onChange:t=>se(t.target.value),placeholder:"Search tasks...",className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:W.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No tasks found"}):W.map(t=>{var s;return e.jsxs("button",{onClick:()=>ye(t),disabled:x,className:"w-full p-3 rounded-lg border border-gray-200 hover:border-indigo-300 hover:bg-indigo-50/50 transition-colors text-left disabled:opacity-50",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-800 truncate",children:[t.critical&&e.jsx("span",{className:"text-red-500 mr-1",children:"ðŸš©"}),t.title]}),e.jsx("div",{className:"flex items-center gap-2 mt-1",children:((s=t.projects)==null?void 0:s.name)&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded-full bg-indigo-100 text-indigo-600",children:t.projects.name})})]},t.id)})})]})]})})]}),u===l.MYDAY&&e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"My Day"}),e.jsx("p",{className:"text-sm text-gray-500",children:Te()})]}),D.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-indigo-100 flex items-center justify-center mx-auto mb-3",children:e.jsx("svg",{className:"w-6 h-6 text-indigo-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})})}),e.jsx("p",{className:"text-gray-500 text-sm mb-1",children:"No tasks for today"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Add tasks to My Day in Trackli"})]}):e.jsxs("div",{className:"space-y-4",children:[K.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xs font-semibold text-indigo-600 uppercase tracking-wide",children:"My Day"}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",K.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:K.map(t=>e.jsx(ge,{task:t,expanded:B===t.id,onToggleExpand:()=>re(B===t.id?null:t.id),onToggleComplete:ie,onToggleMyDay:oe,formatDate:de},t.id))})]}),G.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-xs font-semibold text-amber-600 uppercase tracking-wide",children:"Due Today"}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",G.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:G.map(t=>e.jsx(ge,{task:t,expanded:B===t.id,onToggleExpand:()=>re(B===t.id?null:t.id),onToggleComplete:ie,onToggleMyDay:oe,formatDate:de},t.id))})]})]}),e.jsxs("button",{onClick:w,className:"mt-4 w-full py-2 text-sm text-indigo-600 hover:text-indigo-700 font-medium flex items-center justify-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]})]}),u===l.CREATE&&e.jsxs("div",{className:"p-4",children:[r.subject&&e.jsxs("div",{className:"mb-4 p-3 bg-white rounded-xl border border-gray-200",children:[e.jsx("div",{className:"flex items-center gap-2 text-xs text-gray-500 mb-1",children:r.isAppointment?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})," Meeting"]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})," Email from ",r.sender]})}),e.jsx("p",{className:"text-sm font-medium text-gray-800 truncate",children:r.subject})]}),b&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-xl text-sm text-red-700",children:b}),e.jsxs("form",{onSubmit:ne,className:"bg-white rounded-xl p-4 shadow-sm space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Task Title"}),e.jsx("input",{type:"text",required:!0,value:c.title,onChange:t=>f(s=>({...s,title:t.target.value})),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm",placeholder:"What needs to be done?"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Project"}),e.jsx("select",{value:c.project_id,onChange:t=>f(s=>({...s,project_id:t.target.value})),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm",children:$.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Due Date"}),e.jsx("input",{type:"date",value:c.due_date,onChange:t=>f(s=>({...s,due_date:t.target.value})),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),e.jsxs("select",{value:c.status,onChange:t=>f(s=>({...s,status:t.target.value})),className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"backlog",children:"Backlog"}),e.jsx("option",{value:"todo",children:"To Do"}),e.jsx("option",{value:"in_progress",children:"In Progress"})]})]})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:c.critical,onChange:t=>f(s=>({...s,critical:t.target.checked})),className:"w-4 h-4 rounded border-gray-300 text-red-600 focus:ring-red-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"ðŸš© Critical Task"})]})}),r.isAppointment&&e.jsx("p",{className:"text-xs text-gray-500 bg-indigo-50 p-2 rounded-lg",children:"ðŸ“… This task will be linked to this calendar event"}),e.jsx("button",{type:"submit",disabled:x||!c.title||!c.project_id,className:"w-full py-2.5 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-xl hover:from-indigo-600 hover:to-purple-600 transition-all font-medium text-sm disabled:opacity-50",children:x?"Creating...":r.isAppointment?"Create & Link Task":"Create Task"})]})]}),u===l.UPDATE&&e.jsxs("div",{className:"p-4",children:[r.subject&&e.jsxs("div",{className:"mb-4 p-3 bg-white rounded-xl border border-gray-200",children:[e.jsx("div",{className:"flex items-center gap-2 text-xs text-gray-500 mb-1",children:r.isAppointment?e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})," Meeting"]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})," Email from ",r.sender]})}),e.jsx("p",{className:"text-sm font-medium text-gray-800 truncate",children:r.subject})]}),b&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-xl text-sm text-red-700",children:b}),y?e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-800",children:"Adding note to:"}),e.jsx("button",{onClick:()=>A(null),className:"text-xs text-indigo-600 hover:text-indigo-700",children:"Change"})]}),e.jsxs("div",{className:"p-3 bg-indigo-50 rounded-lg mb-4",children:[e.jsxs("p",{className:"text-sm font-medium text-indigo-900",children:[y.critical&&e.jsx("span",{className:"text-red-500 mr-1",children:"ðŸš©"}),y.title]}),((me=y.projects)==null?void 0:me.name)&&e.jsx("span",{className:"text-xs text-indigo-600",children:y.projects.name})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Add a note (optional)"}),e.jsx("textarea",{value:Y,onChange:t=>V(t.target.value),placeholder:"Add any additional context...",rows:3,className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm resize-none"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mb-4",children:["The ",r.isAppointment?"meeting":"email"," details will be automatically attached."]}),e.jsx("button",{onClick:we,disabled:x,className:"w-full py-2.5 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-xl hover:from-indigo-600 hover:to-purple-600 transition-all font-medium text-sm disabled:opacity-50",children:x?"Updating...":"Update Task"})]}):e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select a task to update"}),e.jsx("input",{type:"text",value:_,onChange:t=>se(t.target.value),placeholder:"Search tasks...",className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-sm mb-3"}),e.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:W.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No tasks found"}):W.map(t=>{var s;return e.jsxs("button",{onClick:()=>A(t),className:"w-full p-3 rounded-lg border border-gray-200 hover:border-indigo-300 hover:bg-indigo-50/50 transition-colors text-left",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-800 truncate",children:[t.critical&&e.jsx("span",{className:"text-red-500 mr-1",children:"ðŸš©"}),t.title]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[((s=t.projects)==null?void 0:s.name)&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded-full bg-indigo-100 text-indigo-600",children:t.projects.name}),e.jsx("span",{className:"text-xs text-gray-400",children:t.status.replace("_"," ")})]})]},t.id)})})]})]})]})]})}function ge({task:o,expanded:T,onToggleExpand:$,onToggleComplete:P,onToggleMyDay:D,formatDate:L}){var C;const M=new Date().toISOString().split("T")[0],O=o.my_day_date===M,U=o.due_date&&o.due_date<M;return e.jsxs("div",{className:`bg-white rounded-xl shadow-sm border transition-all ${o.critical?"border-l-4 border-l-red-500 border-gray-200":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start gap-3 p-3 cursor-pointer",onClick:$,children:[e.jsx("button",{onClick:x=>{x.stopPropagation(),P(o)},className:`mt-0.5 w-5 h-5 rounded-full border-2 flex-shrink-0 flex items-center justify-center transition-colors ${o.status==="done"?"bg-green-500 border-green-500 text-white":"border-gray-300 hover:border-indigo-500"}`,children:o.status==="done"&&e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:`text-sm font-medium ${o.status==="done"?"line-through text-gray-400":"text-gray-800"}`,children:[o.critical&&e.jsx("span",{className:"text-red-500 mr-1",children:"ðŸš©"}),o.title]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[((C=o.projects)==null?void 0:C.name)&&e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded-full bg-indigo-100 text-indigo-600",children:o.projects.name}),o.due_date&&e.jsx("span",{className:`text-xs ${U?"text-red-500 font-medium":"text-gray-400"}`,children:L(o.due_date)}),o.calendar_event_id&&e.jsx("span",{className:"text-xs text-green-500",title:"Linked to calendar",children:"ðŸ“…"})]})]}),e.jsx("svg",{className:`w-4 h-4 text-gray-400 transition-transform ${T?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),T&&e.jsx("div",{className:"px-3 pb-3 pt-0 border-t border-gray-100",children:e.jsxs("div",{className:"pt-2 space-y-2",children:[o.description&&e.jsx("p",{className:"text-xs text-gray-500",children:o.description}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:()=>D(o),className:`flex items-center gap-1 text-xs px-2 py-1 rounded-lg transition-colors ${O?"bg-amber-100 text-amber-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}),O?"In My Day":"Add to My Day"]})})]})})]})}export{Ce as default};
